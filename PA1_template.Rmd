---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
1. Download the csv file activity.csv into your pwd.

2. Read the csv file. Hint : Use the read.csv() function
* code  for reading in the dataset

```{r echo=TRUE}
library(knitr)
library(ggplot2)

MyData <- read.csv(file="E://R//course5//Course5//repdata-data-activity//activity.csv", header=TRUE, sep=",")
str(MyData)

```

* preprocessing the data
+parsing the date string as a Date object.
```{r echo=TRUE}

MyData$date <- as.Date(MyData$date, format="%Y-%m-%d")
str(MyData)

```


## What is mean total number of steps taken per day?

handle the missing values in the dataset

```{r echo=TRUE}
MyDataNoNa <- MyData[!is.na(MyData$steps),]

stepsPerDay <- rowsum(MyDataNoNa, MyDataNoNa$date)
stepsPerDay$date <- as.Date(row.names(stepsPerDay), format="%Y-%m-%d")

```


*histogram of the total number of steps taken each day

```{r echo=TRUE}
library(ggplot2)
stepsPerDayPlot <- ggplot(stepsPerDay, aes(x = date, y = steps))
stepsPerDayPlot <- stepsPerDayPlot + geom_bar(stat = "identity")
stepsPerDayPlot
```



## What is the average daily activity pattern?
*Both the mean and median are reported
```{r echo=TRUE}
mean(stepsPerDay$steps)
median(stepsPerDay$steps)
```

*the 5-minute interval containing the maximum number of steps is reported

```{r echo=TRUE}

stepsPerInterval <- aggregate(MyDataNoNa, list(interval = MyDataNoNa$interval), mean)
stepsPerInterval$time <- formatC(stepsPerInterval$interval, width = 4, format = "d", flag = "0")
stepsPerInterval$time <- as.POSIXct(stepsPerInterval$time, format="%H%M")
stepsPerIntervalPlot <- ggplot(stepsPerInterval, aes(x = time, y = steps)) +
   geom_bar(stat = "identity")
stepsPerIntervalPlot

mostStepsOfTheDay <- stepsPerInterval[which.max(stepsPerInterval$steps),]$interval
mostStepsOfTheDay
```

On average taken by this person is `r mostStepsOfTheDay` .


## Imputing missing values
* description of a strategy for imputing missing data

create a new dataset that is same with original dataset , but with the NA filled in.

```{r echo=TRUE}
MyDataImputed <- NULL
MyDataMissing <- MyData[is.na(MyData$steps), ]

for(i in 1:nrow(MyDataMissing)) {
    row <- MyDataMissing[i,]
    row$steps <- stepsPerInterval[stepsPerInterval$interval == row$interval, ]$steps[1]
    MyDataImputed <<- rbind(row, MyDataImputed)
}

MyDataImputed <- rbind(MyDataImputed, MyData[!is.na(MyData$steps), ])

```

* a histogram of the total number of steps taken each day after missing values were impute


```{r echo=TRUE}
stepsPerDayImp <- rowsum(MyDataImputed, MyDataImputed$date)
stepsPerDayImp$date <- as.Date(row.names(stepsPerDayImp), format="%Y-%m-%d")

stepsPerDayImpPlot <- ggplot(stepsPerDayImp, aes(x = date, y = steps))
stepsPerDayImpPlot <- stepsPerDayImpPlot + geom_bar(stat = "identity")
stepsPerDayImpPlot


```

median and the average steps per day are exactly the same.

```{r echo=TRUE}
mean(stepsPerDayImp$steps)
median(stepsPerDayImp$steps)
```


## Are there differences in activity patterns between weekdays and weekends?

*create a  factor variable with two levels (weekday and weekend )
*a panel plot comparing the average number of steps taken per 5-minute interval across weekdays and weekends


```{r echo=TRUE}
MyDataImputed['type_of_day'] <- weekdays(as.Date(MyDataImputed$date))
MyDataImputed$type_of_day[MyDataImputed$type_of_day  %in% c('Saturday','Sunday') ] <- "weekend"
MyDataImputed$type_of_day[MyDataImputed$type_of_day != "weekend"] <- "weekday"

# convert type_of_day from character to factor
MyDataImputed$type_of_day <- as.factor(MyDataImputed$type_of_day)

# calculate average steps by interval across all days
df_imputed_steps_by_interval <- aggregate(steps ~ interval + type_of_day, MyDataImputed, mean)

# creat a plot
qplot(interval, 
      steps, 
      data = df_imputed_steps_by_interval, 
      type = 'l', 
      geom=c("line"),xlab = "Interval", ylab = "Number of steps", main = "") +
      facet_wrap(~ type_of_day, ncol = 1)

```


